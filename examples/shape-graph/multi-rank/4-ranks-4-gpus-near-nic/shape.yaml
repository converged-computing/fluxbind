# A complex multi-rank job for 4 ranks.
# The total allocation asks for 4 GPUs and 16 cores.
# The affinity key sorts the GPUs by closeness to the NIC before partitioning.
# When run with --local-size=4, each rank will get 1 GPU and 4 cores.
resources:
  - type: machine
    count: 1
    with:
      - type: gpu
        count: 4
        affinity:
          type: nic
      - type: core
        count: 16
        affinity:
          type: nic
